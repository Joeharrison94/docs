<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A collection of my findings throught both my enterprise and home labbing experiences"><link href=https://sudo-kraken.github.io/kvm-ubuntu/ rel=canonical><link href=../cloudflared/ rel=prev><link href=../mkdocs-cheatsheet/ rel=next><link rel=icon href=../assets/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.4"><title>Install KVM (Kernel-Based Virtualization) On Ubuntu Server - JH Docs</title><link rel=stylesheet href=../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kernel-based-virtualization-deploys-virtual-machines-on-ubuntu-server-os class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <style>
    div[data-md-component="announce"] {
        z-index: 10;
    }

    div[data-md-component="announce"] a {
        color: white;
    }

    div[data-md-component="announce"] a:hover, div[data-md-component="announce"] a:focus {
        transition: ease-in 150ms;
        color: #ccc;
    }

    div[data-md-component="announce"] .md-banner__button {
        color: #ccc;
    }

    div[data-md-component="announce"] .md-banner.hidden {
        display: none;
    }

    div[data-md-component="announce"] .twemoji {
        margin-top: 2px;
    }
</style> <button id=announce-bar-close class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path> </svg> </button> If you like my repos, please consider supporting me via <a target=_blank href=https://www.buymeacoffee.com/jharrison94 style="vertical-align: middle;"><img src=https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png alt="Buy Me A Coffee" style="height: auto !important; width: auto !important; vertical-align: middle;"></a> <script>
    announceBarKey = 'announce-bar-closed-sponsor';
    document.getElementById('announce-bar-close').addEventListener('click', (e) => {
        localStorage.setItem(announceBarKey, 'true');
        document.querySelector('div[data-md-component="announce"] .md-banner').style.display = 'none';
    });
    if (localStorage.getItem(announceBarKey) === 'true') {
        document.querySelector('div[data-md-component="announce"] .md-banner').style.display = 'none';
    }
</script> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=/docs/ title="JH Docs" class="md-header__button md-logo" aria-label="JH Docs" data-md-component=logo> <img src=../assets/portal.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> JH Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Install KVM (Kernel-Based Virtualization) On Ubuntu Server </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=orange aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/sudo-kraken/terraform-gcp-ubuntu-container-ready-e2-micro-vm title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sudo-kraken </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=/docs/ title="JH Docs" class="md-nav__button md-logo" aria-label="JH Docs" data-md-component=logo> <img src=../assets/portal.png alt=logo> </a> JH Docs </label> <div class=md-nav__source> <a href=https://github.com/sudo-kraken/terraform-gcp-ubuntu-container-ready-e2-micro-vm title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sudo-kraken </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Welcome </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gcp-free-forever/ class=md-nav__link> <span class=md-ellipsis> Google Cloud Platform - Free Forever VM Setup & Configuration </span> </a> </li> <li class=md-nav__item> <a href=../cloudflared/ class=md-nav__link> <span class=md-ellipsis> Cloudflared Argo Tunnels with Zero Trust </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Install KVM (Kernel-Based Virtualization) On Ubuntu Server </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Install KVM (Kernel-Based Virtualization) On Ubuntu Server </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#install-dependancies class=md-nav__link> <span class=md-ellipsis> Install Dependancies </span> </a> </li> <li class=md-nav__item> <a href=#networking class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=#installing-a-vm class=md-nav__link> <span class=md-ellipsis> Installing a VM </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../mkdocs-cheatsheet/ class=md-nav__link> <span class=md-ellipsis> Markdown Cheatsheet For MkDocs </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kernel-based-virtualization-deploys-virtual-machines-on-ubuntu-server-os><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M469.2 75a75.6 75.6 0 1 0-151.3 0 75.6 75.6 0 1 0 151.2 0zm-315 165.7a75.6 75.6 0 1 0-151.2 0 75.6 75.6 0 1 0 151.2 0zM57 346c18.6 46.9 51 87 93 115.1s91.5 42.6 142 41.7c-14.7-18.6-22.9-41.5-23.2-65.2-6.8-.9-13.3-2.1-19.5-3.4-26.8-5.7-51.9-17.3-73.6-34s-39.3-38.1-51.7-62.5c-20.9 9.9-44.5 12.8-67.1 8.2zm395.1 89.8a75.6 75.6 0 1 0-151.2 0 75.6 75.6 0 1 0 151.2 0zm-8.1-84.2c18.5 14.8 31.6 35.2 37.2 58.2 33.3-41.3 52.6-92.2 54.8-145.2s-12.5-105.4-42.2-149.4c-8.6 21.5-24 39.6-43.8 51.6 15.4 28.6 22.9 60.8 21.9 93.2s-10.7 64-28 91.6zM101.1 135.4c12.4 2.7 24.3 7.5 35.1 14.3 16.6-24.2 38.9-44.1 64.8-58s54.8-21.3 84.2-21.7c.2-5.9.9-11.9 2-17.7C290.8 35.6 298.3 20 309 6.8c-47.7-3.8-95.4 6-137.6 28.5S94.3 91.7 70.8 133.4c2.7-.2 5.3-.3 8-.3 7.5 0 15 .8 22.4 2.3z"/></svg></span> Kernel-Based Virtualization - Deploys Virtual Machines on Ubuntu Server OS<a class=headerlink href=#kernel-based-virtualization-deploys-virtual-machines-on-ubuntu-server-os title="Permanent link">&para;</a></h1> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>Before you continue you must have enabled CPU virtualization in the bios, this will vary from manufacturer to manufacturer so ensure that you check your motherboard manual for the correct setting. Here is a <a href=https://www.bleepingcomputer.com/tutorials/how-to-enable-cpu-virtualization-in-your-computer-bios/ >link</a> to a handy guide to get you started with this.</p> <h2 id=install-dependancies>Install Dependancies<a class=headerlink href=#install-dependancies title="Permanent link">&para;</a></h2> <p>Install Kvm and all required dependencies to setup a virtualization environment on your <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M469.2 75a75.6 75.6 0 1 0-151.3 0 75.6 75.6 0 1 0 151.2 0zm-315 165.7a75.6 75.6 0 1 0-151.2 0 75.6 75.6 0 1 0 151.2 0zM57 346c18.6 46.9 51 87 93 115.1s91.5 42.6 142 41.7c-14.7-18.6-22.9-41.5-23.2-65.2-6.8-.9-13.3-2.1-19.5-3.4-26.8-5.7-51.9-17.3-73.6-34s-39.3-38.1-51.7-62.5c-20.9 9.9-44.5 12.8-67.1 8.2zm395.1 89.8a75.6 75.6 0 1 0-151.2 0 75.6 75.6 0 1 0 151.2 0zm-8.1-84.2c18.5 14.8 31.6 35.2 37.2 58.2 33.3-41.3 52.6-92.2 54.8-145.2s-12.5-105.4-42.2-149.4c-8.6 21.5-24 39.6-43.8 51.6 15.4 28.6 22.9 60.8 21.9 93.2s-10.7 64-28 91.6zM101.1 135.4c12.4 2.7 24.3 7.5 35.1 14.3 16.6-24.2 38.9-44.1 64.8-58s54.8-21.3 84.2-21.7c.2-5.9.9-11.9 2-17.7C290.8 35.6 298.3 20 309 6.8c-47.7-3.8-95.4 6-137.6 28.5S94.3 91.7 70.8 133.4c2.7-.2 5.3-.3 8-.3 7.5 0 15 .8 22.4 2.3z"/></svg></span> Ubuntu 20.04 LTS sever using command:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Here is what you are installing.</p> <p><code>qemu</code> - A generic machine emulator and virtualizer.</p> <p><code>qemu-kvm</code> - QEMU metapackage for KVM support (i.e. QEMU Full virtualization on x86 hardware).</p> <p><code>libvirt-clients</code> - programs for the libvirt library.</p> <p><code>libvirt-daemon-system</code> - Libvirt daemon configuration files.</p> <p><code>virtinst</code> - programs to create and clone virtual machines.</p> <p><code>bridge-utils</code> - utilities for configuring the Linux Ethernet bridge.</p> </div> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>qemu<span class=w> </span>qemu-kvm<span class=w> </span>libvirt-clients<span class=w> </span>libvirt-daemon-system<span class=w> </span>virtinst<span class=w> </span>bridge-utils
</code></pre></div> </div> </div> </div> <p>With the above packages installed, before you can continue you must check your hosts virtualisation capabilities, execute the following command to make sure your processor supports virtualisation capabilities and it has been enabled properly in the BIOS:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>kvm-ok
</code></pre></div> </div> </div> </div> <p>Sample Output <div class=highlight><pre><span></span><code>INFO:<span class=w> </span>/dev/kvm<span class=w> </span>exists
KVM<span class=w> </span>acceleration<span class=w> </span>can<span class=w> </span>be<span class=w> </span>used
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>If you do not get the above output, you need to check the BIOS settings mentioned in the prerequisites section</p> </div> <p>Once KVM is installed and you have verified that KVM is happy with the virtualization capabilites, start the <code>libvertd</code> service (If it is not started already):</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>libvirtd
sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>libvirtd
</code></pre></div> </div> </div> </div> <p>Check the status of libvirtd service with command:</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><div class=highlight><pre><span></span><code>systemctl<span class=w> </span>status<span class=w> </span>libvirtd
</code></pre></div> Sample output:</p> <div class=highlight><pre><span></span><code><span class=w> </span>●<span class=w> </span>libvirtd.service<span class=w> </span>-<span class=w> </span>Virtualization<span class=w> </span>daemon<span class=w>    </span>
<span class=w>     </span>Loaded:<span class=w> </span>loaded<span class=w> </span><span class=o>(</span>/lib/systemd/system/libvirtd.service<span class=p>;</span><span class=w> </span>enabled<span class=p>;</span><span class=w> </span>vendor<span class=w> </span>preset:<span class=w> </span>enabled<span class=o>)</span>
<span class=w>     </span>Active:<span class=w> </span>active<span class=w> </span><span class=o>(</span>running<span class=o>)</span><span class=w> </span>since<span class=w> </span>Sat<span class=w> </span><span class=m>2020</span>-07-04<span class=w> </span><span class=m>08</span>:13:41<span class=w> </span>UTC<span class=p>;</span><span class=w> </span>7min<span class=w> </span>ago
TriggeredBy:<span class=w> </span>●<span class=w> </span>libvirtd-ro.socket
<span class=w>             </span>●<span class=w> </span>libvirtd-admin.socket
<span class=w>             </span>●<span class=w> </span>libvirtd.socket
<span class=w>       </span>Docs:<span class=w> </span>man:libvirtd<span class=o>(</span><span class=m>8</span><span class=o>)</span>
<span class=w>             </span>https://libvirt.org
<span class=w>   </span>Main<span class=w> </span>PID:<span class=w> </span><span class=m>4492</span><span class=w> </span><span class=o>(</span>libvirtd<span class=o>)</span>
<span class=w>      </span>Tasks:<span class=w> </span><span class=m>19</span><span class=w> </span><span class=o>(</span>limit:<span class=w> </span><span class=m>32768</span><span class=o>)</span>
<span class=w>     </span>Memory:<span class=w> </span><span class=m>12</span>.9M
<span class=w>     </span>CGroup:<span class=w> </span>/system.slice/libvirtd.service
<span class=w>             </span>├─4492<span class=w> </span>/usr/sbin/libvirtd
<span class=w>             </span>├─4641<span class=w> </span>/usr/sbin/dnsmasq<span class=w> </span>--conf-file<span class=o>=</span>/var/lib/libvirt/dnsmasq/default.conf<span class=w> </span>--l&gt;
<span class=w>             </span>└─4642<span class=w> </span>/usr/sbin/dnsmasq<span class=w> </span>--conf-file<span class=o>=</span>/var/lib/libvirt/dnsmasq/default.conf<span class=w> </span>--l&gt;

<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>compile<span class=w> </span><span class=nb>time</span><span class=w> </span>options:<span class=w> </span>IPv6<span class=w> </span>GNU-getopt<span class=w> </span>DBus<span class=w> </span>i18n&gt;
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq-dhcp<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>DHCP,<span class=w> </span>IP<span class=w> </span>range<span class=w> </span><span class=m>192</span>.168.122.2<span class=w> </span>--<span class=w> </span><span class=m>192</span>.168.12&gt;
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq-dhcp<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>DHCP,<span class=w> </span>sockets<span class=w> </span>bound<span class=w> </span>exclusively<span class=w> </span>to<span class=w> </span>interfa&gt;
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>reading<span class=w> </span>/etc/resolv.conf
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>using<span class=w> </span>nameserver<span class=w> </span><span class=m>127</span>.0.0.53#53
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span><span class=nb>read</span><span class=w> </span>/etc/hosts<span class=w> </span>-<span class=w> </span><span class=m>7</span><span class=w> </span>addresses
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span><span class=nb>read</span><span class=w> </span>/var/lib/libvirt/dnsmasq/default.addnhosts&gt;
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq-dhcp<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span><span class=nb>read</span><span class=w> </span>/var/lib/libvirt/dnsmasq/default.host&gt;
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>reading<span class=w> </span>/etc/resolv.conf
<span class=w> </span>Jul<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>08</span>:13:42<span class=w> </span>ubuntuserver<span class=w> </span>dnsmasq<span class=o>[</span><span class=m>4641</span><span class=o>]</span>:<span class=w> </span>using<span class=w> </span>nameserver<span class=w> </span><span class=m>127</span>.0.0.53#53
</code></pre></div> </div> </div> </div> <p>The <code>libvertd</code> service has been enabled and started! Let us continue witht the networking now.</p> <h2 id=networking>Networking<a class=headerlink href=#networking title="Permanent link">&para;</a></h2> <p>We shall be using bridged networking with KVM. A bridged network shares the real network interface of the host computer with other VMs to connect to the outside network. Therefore each VM can bind directly to any available IPv4 or IPv6 addresses, just like a physical computer would do.</p> <p>By default KVM setups a private virtual bridge, so that all VMs can communicate with each another, within the host computer internally. It provides its own subnet and DHCP to configure the guest’s network and uses NAT to access the host network.</p> <p>The KVM default network <code>virbr0</code> uses <code>192.168.122.1/24</code> IP address. All the VMs will use an IP address in the <code>192.168.122.0/24</code> IP range and the host OS will be reachable at <code>192.168.122.1</code>. You should be able to ssh into the host OS (at <code>192.168.122.1</code>) from inside the guest OS and use scp to copy files back and forth.</p> <p>It is OK if you only access the VMs inside from the host itself. However we can't access the VMs from other remote systems in the hosts attached network.</p> <p>Because they use different IP range i.e. <code>10.0.180.0/24</code> in my case. In order to access the VMs from other remote hosts, we must setup a public bridge that runs on the host network and uses whatever external DHCP server is on the host network.</p> <p>To put this in layman terms, we are going to make all VMs to use the same subnet used by the host system.</p> <p>Before setting up a public bridged network, we should disable Netfilter for performance and security reasons. Netfilter is currently enabled on bridges by default.</p> <p>To disable netfilter, create a file called <code>/etc/sysctl.d/bridge.conf</code></p> <div class="tabbed-set tabbed-alternate" data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>nano<span class=w> </span>/etc/sysctl.d/bridge.conf
</code></pre></div> </div> </div> </div> <p>Add the following lines:</p> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>net.bridge.bridge-nf-call-ip6tables<span class=o>=</span><span class=m>0</span>
net.bridge.bridge-nf-call-iptables<span class=o>=</span><span class=m>0</span>
net.bridge.bridge-nf-call-arptables<span class=o>=</span><span class=m>0</span>
</code></pre></div> </div> </div> </div> <p>Save and close the file.</p> <p>Then create another file called <code>/etc/udev/rules.d/99-bridge.rules</code></p> <div class="tabbed-set tabbed-alternate" data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>nano<span class=w> </span>/etc/udev/rules.d/99-bridge.rules
</code></pre></div> </div> </div> </div> <p>Add the following line:</p> <div class="tabbed-set tabbed-alternate" data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nv>ACTION</span><span class=o>==</span><span class=s2>&quot;add&quot;</span>,<span class=w> </span><span class=nv>SUBSYSTEM</span><span class=o>==</span><span class=s2>&quot;module&quot;</span>,<span class=w> </span><span class=nv>KERNEL</span><span class=o>==</span><span class=s2>&quot;br_netfilter&quot;</span>,<span class=w> </span><span class=nv>RUN</span><span class=o>+=</span><span class=s2>&quot;/sbin/sysctl -p /etc/sysctl.d/bridge.conf&quot;</span>
</code></pre></div> </div> </div> </div> <p>This will set the necessary flags to disable netfilter on bridges at the appropriate place in system start-up. Save and close the file. </p> <p>Reboot your system to take effect these changes.</p> <p>Next, we should disable the default networking that KVM installed for itself.</p> <p>Find the name of KVM default network interfaces using "ip link" command:</p> <div class="tabbed-set tabbed-alternate" data-tabs=9:1><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>ip<span class=w> </span>link
</code></pre></div> </div> </div> </div> <p>Sample output:</p> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=m>1</span>:<span class=w> </span>lo:<span class=w> </span>&lt;LOOPBACK,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>65536</span><span class=w> </span>qdisc<span class=w> </span>noqueue<span class=w> </span>state<span class=w> </span>UNKNOWN<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/loopback<span class=w> </span><span class=m>00</span>:00:00:00:00:00<span class=w> </span>brd<span class=w> </span><span class=m>00</span>:00:00:00:00:00
<span class=m>2</span>:<span class=w> </span>enp0s3:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:8a:52:94<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>3</span>:<span class=w> </span>enp0s8:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:10:7c:c1<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>4</span>:<span class=w> </span>enp0s9:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:5d:61:28<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>5</span>:<span class=w> </span>virbr0:<span class=w> </span>&lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>noqueue<span class=w> </span>state<span class=w> </span>DOWN<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>100</span><span class=w>    </span><span class=m>0</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>52</span>:54:00:1f:a2:e7<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>6</span>:<span class=w> </span>virbr0-nic:<span class=w> </span>&lt;BROADCAST,MULTICAST&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>master<span class=w> </span>virbr0<span class=w> </span>state<span class=w> </span>DOWN<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>52</span>:54:00:1f:a2:e7<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
</code></pre></div> </div> </div> </div> <p>As you see in the above output, the entries <code>virbr0</code> and <code>virbr0-nic</code> are the KVM networks.</p> <p>Let us remove the default KVM network with command:</p> <div class="tabbed-set tabbed-alternate" data-tabs=11:1><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><div class=tabbed-labels><label for=__tabbed_11_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>virsh<span class=w> </span>net-destroy<span class=w> </span>default
</code></pre></div> </div> </div> </div> <p>Sample output:</p> <div class="tabbed-set tabbed-alternate" data-tabs=12:1><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><div class=tabbed-labels><label for=__tabbed_12_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>Network<span class=w> </span>default<span class=w> </span>destroyed
Undefine<span class=w> </span>the<span class=w> </span>default<span class=w> </span>network<span class=w> </span>with<span class=w> </span>command:<span class=w> </span>virsh<span class=w> </span>net-undefine<span class=w> </span>default
</code></pre></div> </div> </div> </div> <p>Now run the command it displayed above</p> <div class="tabbed-set tabbed-alternate" data-tabs=13:1><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><div class=tabbed-labels><label for=__tabbed_13_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>virsh<span class=w> </span>net-undefine<span class=w> </span>default
</code></pre></div> </div> </div> </div> <p>Sample output:</p> <div class="tabbed-set tabbed-alternate" data-tabs=14:1><input checked=checked id=__tabbed_14_1 name=__tabbed_14 type=radio><div class=tabbed-labels><label for=__tabbed_14_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>Network<span class=w> </span>default<span class=w> </span>has<span class=w> </span>been<span class=w> </span>undefined
</code></pre></div> </div> </div> </div> <details class=tip open=open> <summary>Tip</summary> <p>If the above commands didn't work for any reason, you can use these commands to disable and undefine KVM default network.</p> <div class="tabbed-set tabbed-alternate" data-tabs=15:1><input checked=checked id=__tabbed_15_1 name=__tabbed_15 type=radio><div class=tabbed-labels><label for=__tabbed_15_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>ip<span class=w> </span>link<span class=w> </span>delete<span class=w> </span>virbr0<span class=w> </span><span class=nb>type</span><span class=w> </span>bridge
sudo<span class=w> </span>ip<span class=w> </span>link<span class=w> </span>delete<span class=w> </span>virbr0-nic
</code></pre></div> </div> </div> </div> </details> <p>Now run <code>ip link</code> again to verify if the virbr0 and virbr0-nic interfaces are actually deleted.</p> <p>$ ip link=== "<span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash" <div class=highlight><pre><span></span><code><span class=m>1</span>:<span class=w> </span>lo:<span class=w> </span>&lt;LOOPBACK,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>65536</span><span class=w> </span>qdisc<span class=w> </span>noqueue<span class=w> </span>state<span class=w> </span>UNKNOWN<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/loopback<span class=w> </span><span class=m>00</span>:00:00:00:00:00<span class=w> </span>brd<span class=w> </span><span class=m>00</span>:00:00:00:00:00
<span class=m>2</span>:<span class=w> </span>enp0s3:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:8a:52:94<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>3</span>:<span class=w> </span>enp0s8:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:10:7c:c1<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
<span class=m>4</span>:<span class=w> </span>enp0s9:<span class=w> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class=w> </span>mtu<span class=w> </span><span class=m>1500</span><span class=w> </span>qdisc<span class=w> </span>fq_codel<span class=w> </span>state<span class=w> </span>UP<span class=w> </span>mode<span class=w> </span>DEFAULT<span class=w> </span>group<span class=w> </span>default<span class=w> </span>qlen<span class=w> </span><span class=m>1000</span>
<span class=w>    </span>link/ether<span class=w> </span><span class=m>08</span>:00:27:5d:61:28<span class=w> </span>brd<span class=w> </span>ff:ff:ff:ff:ff:ff
</code></pre></div></p> <div class="admonition success"> <p class=admonition-title>See? Now the KVM default networks are gone.</p> </div> <p>Now, let us setup the KVM public bridge to use when creating a new VM.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Do not use wireless network interface cards for bridges. Most wireless interlaces do not support bridging. Always use wired network interfaces for seamless connectivity!</p> </div> <p>To create a network bridge in host, edit <code>/etc/netplan/00-installer-config.yaml</code> file and add the bridge details.</p> <p>Here is the default contents of the <code>00-installer-config.yaml</code> file in my Ubuntu 20.04 LTS server.</p> <div class="tabbed-set tabbed-alternate" data-tabs=16:1><input checked=checked id=__tabbed_16_1 name=__tabbed_16 type=radio><div class=tabbed-labels><label for=__tabbed_16_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><div class=highlight><pre><span></span><code>cat<span class=w> </span>/etc/netplan/00-installer-config.yaml
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># This is the network config written by &#39;subiquity&#39;</span>
<span class=nt>network</span><span class=p>:</span>
<span class=w>  </span><span class=nt>ethernets</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enp3s0</span><span class=p>:</span>
<span class=w>      </span><span class=nt>dhcp4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>      </span><span class=nt>addresses</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.180.4/24</span>
<span class=w>      </span><span class=nt>gateway4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.180.1</span>
<span class=w>      </span><span class=nt>nameservers</span><span class=p>:</span>
<span class=w>        </span><span class=nt>addresses</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.180.1</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.64.36.1</span>
<span class=w>        </span><span class=nt>search</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class=w>  </span><span class=nt>renderer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NetworkManager</span>
</code></pre></div></p> </div> </div> </div> <p>As you see, I have a wired network interface namely enp3s0 in my Ubuntu server.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Before editing this file, backup your existing <code>/etc/netplan/00-installer-config.yaml</code> file.</p> <div class="tabbed-set tabbed-alternate" data-tabs=17:1><input checked=checked id=__tabbed_17_1 name=__tabbed_17 type=radio><div class=tabbed-labels><label for=__tabbed_17_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>cp<span class=w> </span>/etc/netplan/00-installer-config.yaml<span class=o>{</span>,.backup<span class=o>}</span>
</code></pre></div> </div> </div> </div> </div> <p>Then edit the default config file using your favorite editor, for me this is nano.</p> <div class="tabbed-set tabbed-alternate" data-tabs=18:1><input checked=checked id=__tabbed_18_1 name=__tabbed_18 type=radio><div class=tabbed-labels><label for=__tabbed_18_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>nano<span class=w> </span>/etc/netplan/00-installer-config.yaml
</code></pre></div> </div> </div> </div> <p>Add/modify it like below you should also note that the subnet for you will likely differ from mine so replace the below values that matches with your network:</p> <div class="tabbed-set tabbed-alternate" data-tabs=19:1><input checked=checked id=__tabbed_19_1 name=__tabbed_19 type=radio><div class=tabbed-labels><label for=__tabbed_19_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># This is the network config written by &#39;subiquity&#39;</span>
network:
<span class=w>  </span>ethernets:
<span class=w>    </span>enp3s0:
<span class=w>      </span>dhcp4:<span class=w> </span><span class=nb>false</span>
<span class=w>  </span>bridges:
<span class=w>    </span>br0:
<span class=w>      </span>interfaces:<span class=w> </span><span class=o>[</span><span class=w> </span>enp3s0<span class=w> </span><span class=o>]</span>
<span class=w>      </span>addresses:<span class=w> </span><span class=o>[</span><span class=m>10</span>.0.180.4/24<span class=o>]</span>
<span class=w>      </span>gateway4:<span class=w> </span><span class=m>10</span>.0.180.1
<span class=w>      </span>mtu:<span class=w> </span><span class=m>1500</span>
<span class=w>      </span>nameservers:
<span class=w>        </span>addresses:<span class=w> </span><span class=o>[</span><span class=m>10</span>.0.180.1,1.1.1.1<span class=o>]</span>
<span class=w>      </span>parameters:
<span class=w>        </span>stp:<span class=w> </span><span class=nb>true</span>
<span class=w>        </span>forward-delay:<span class=w> </span><span class=m>4</span>
<span class=w>      </span>dhcp4:<span class=w> </span>no
<span class=w>      </span>dhcp6:<span class=w> </span>no
<span class=w>  </span>version:<span class=w> </span><span class=m>2</span>
<span class=w>  </span>renderer:<span class=w> </span>NetworkManager
</code></pre></div> </div> </div> </div> <p>Here, the bridge network interface <code>br0</code> is attached to host's network interface <code>enp0s3</code>. The ip address of <code>br0</code> is <code>10.0.180.4</code>. The gateway is <code>10.0.180.1</code>. I use Cloudflare DNS servers (<code>1.1.1.1</code> and <code>1.0.0.1</code>) to connect to Internet.</p> <p>Make sure the space indentation are exactly same as above. If the line indentations are not correct, the bridged network interface will not activate. </p> <div class="admonition danger"> <p class=admonition-title>Warning!</p> <p><code>Again to reiterate replace the above values that matches with your network</code>.</p> </div> <p>After modifying the network config file, save and close it. Apply the changes by running the following command:</p> <div class="tabbed-set tabbed-alternate" data-tabs=20:1><input checked=checked id=__tabbed_20_1 name=__tabbed_20 type=radio><div class=tabbed-labels><label for=__tabbed_20_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>netplan<span class=w> </span>--debug<span class=w>  </span>apply
</code></pre></div> </div> </div> </div> <p>You can also use the <code>brctl</code> command to show the bridge status:</p> <p>Sample output:</p> <div class="tabbed-set tabbed-alternate" data-tabs=21:1><input checked=checked id=__tabbed_21_1 name=__tabbed_21 type=radio><div class=tabbed-labels><label for=__tabbed_21_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>brctl<span class=w> </span>show<span class=w> </span>br0

bridge<span class=w> </span>name<span class=w>    </span>bridge<span class=w> </span>id<span class=w>            </span>STP<span class=w>    </span>enabled<span class=w> </span>interfaces
br0<span class=w>            </span><span class=m>8000</span>.0800278a5294<span class=w>    </span>yes<span class=w>    </span>enp0s3
</code></pre></div> </div> </div> </div> <p>Now we should configure KVM to use this bridge. To do that, create a an XML file called <code>host-bridge.xml</code>.</p> <p>It doesn't really matter where you create this file but I made it in <code>~/</code> (which is <code>/home/username/</code>).</p> <div class="tabbed-set tabbed-alternate" data-tabs=22:1><input checked=checked id=__tabbed_22_1 name=__tabbed_22 type=radio><div class=tabbed-labels><label for=__tabbed_22_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>nano<span class=w> </span>host-bridge.xml
</code></pre></div> </div> </div> </div> <p>Add the following lines:</p> <div class="tabbed-set tabbed-alternate" data-tabs=23:1><input checked=checked id=__tabbed_23_1 name=__tabbed_23 type=radio><div class=tabbed-labels><label for=__tabbed_23_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.89 3 1.96.4L11.11 21l-1.96-.4L12.89 3m6.7 9L16 8.41V5.58L22.42 12 16 18.41v-2.83L19.59 12M1.58 12 8 5.58v2.83L4.41 12 8 15.58v2.83L1.58 12Z"/></svg></span> xml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>&lt;network&gt;</span>
<span class=w>  </span><span class=nt>&lt;name&gt;</span>host-bridge<span class=nt>&lt;/name&gt;</span>
<span class=w>  </span><span class=nt>&lt;forward</span><span class=w> </span><span class=na>mode=</span><span class=s>&quot;bridge&quot;</span><span class=nt>/&gt;</span>
<span class=w>  </span><span class=nt>&lt;bridge</span><span class=w> </span><span class=na>name=</span><span class=s>&quot;br0&quot;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;/network&gt;</span>
</code></pre></div> </div> </div> </div> <p>Run the following commands to start the newly created bridge and make it as default bridge for all VMs.</p> <div class="tabbed-set tabbed-alternate" data-tabs=24:1><input checked=checked id=__tabbed_24_1 name=__tabbed_24 type=radio><div class=tabbed-labels><label for=__tabbed_24_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>virsh<span class=w> </span>net-define<span class=w> </span>host-bridge.xml
virsh<span class=w> </span>net-start<span class=w> </span>host-bridge
virsh<span class=w> </span>net-autostart<span class=w> </span>host-bridge
</code></pre></div> </div> </div> </div> <p>To verify if the bridge is active and started, run:</p> <div class="tabbed-set tabbed-alternate" data-tabs=25:1><input checked=checked id=__tabbed_25_1 name=__tabbed_25 type=radio><div class=tabbed-labels><label for=__tabbed_25_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>virsh<span class=w> </span>net-list<span class=w> </span>--all
</code></pre></div> </div> </div> </div> <p>Sample output:</p> <div class="tabbed-set tabbed-alternate" data-tabs=26:1><input checked=checked id=__tabbed_26_1 name=__tabbed_26 type=radio><div class=tabbed-labels><label for=__tabbed_26_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>Name<span class=w>          </span>State<span class=w>    </span>Autostart<span class=w>   </span>Persistent
------------------------------------------------
host-bridge<span class=w>   </span>active<span class=w>   </span>yes<span class=w>         </span>yes
</code></pre></div> </div> </div> </div> <div class="admonition success"> <p class=admonition-title>Congratulations! You have successfully setup KVM bridge and it is active now.</p> </div> <h2 id=installing-a-vm>Installing a VM<a class=headerlink href=#installing-a-vm title="Permanent link">&para;</a></h2> <p>To install a VM you will need to have an ISO on hand for the installation process, as well as for an easy way to access a console session to install the virtual machine you should try <a href=https://cockpit-project.org/running.html>cockpit</a>. Cockpit is an amazing open source tool that comes included in Ubuntu <code>17.04</code> and later. To activate cockpit you should run the below commands, included in these are the additional addons for virtual machine management and package updates etc.</p> <div class="tabbed-set tabbed-alternate" data-tabs=27:1><input checked=checked id=__tabbed_27_1 name=__tabbed_27 type=radio><div class=tabbed-labels><label for=__tabbed_27_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>apt<span class=w> </span>install<span class=w> </span>cockpit<span class=w> </span>cockpit-machines<span class=w> </span>cockpit-packagekit<span class=w> </span>-y
sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>cockpit
sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>cockpit
</code></pre></div> </div> </div> </div> <p><code>cockpit</code> will no be accessible on <code>ip-address-of-machine:9090</code> via a webbrowser.</p> <p>Now once you have installed cockpit you are ready to deploy your first virtual machine!</p> <div class="tabbed-set tabbed-alternate" data-tabs=28:1><input checked=checked id=__tabbed_28_1 name=__tabbed_28 type=radio><div class=tabbed-labels><label for=__tabbed_28_1><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5V9m4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg></span> bash</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="admonition info"> <p class=admonition-title>Important Information</p> <p>For the command <code>virt-install</code> there are a lot of arguments that we will be adding, here is a brief explanation of these arguments, ensure you change the values to suit your needs.</p> <p><code>--name</code> - Is the name of the virtual machine you wish to create.</p> <p><code>--ram</code> - Is the amount of RAM in MB's that you want to allocate to the VM.</p> <p><code>--vcpus</code> - Is the amount of CPU threads that you want to allocate to the VM.</p> <p><code>--cpu</code> - Expose the host CPUs configuration to the guest. This enables the guest to take advantage of many of the host CPUs features (better performance), but may cause issues if migrating the guest to a host without an identical CPU.</p> <p><code>--hvm</code> - Requests the use of full virtualization, if both para &amp; full virtualization are available on the host. This parameter may not be available if connecting to a Xen hypervisor on a machine without hardware virtualization support. This parameter is implied if connecting to a <code>QEMU</code> based hypervisor.</p> <p><code>--disk path=</code> - Is the path to the location in which you wish to stor the VM's hard disk.</p> <p><code>,size</code> - Is the size of the VM's hard disk in GB's.</p> <p><code>--cdrom</code> - Is the path to the ISO file you wish to install the VM OS from.</p> <p><code>--network</code> - Is the network that you wan to put the VM on, in our case the bridge network we created earlier.</p> <p><code>--graphics</code> - Specifies the graphical display configuration. This does not configure any virtual hardware, just how the guest's graphical display can be accessed.</p> <p><code>--autorestart</code> - Set the <code>autostart</code> flag for the VM. This causes the VM to be started on host boot up / reboot.</p> </div> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>virt-install<span class=w> </span>--name<span class=w> </span>VM-NAME-HERE<span class=w> </span>--ram<span class=o>=</span><span class=m>4096</span><span class=w> </span>--vcpus<span class=o>=</span><span class=m>4</span><span class=w> </span>--cpu<span class=w> </span>host<span class=w> </span>--hvm<span class=w> </span>--disk<span class=w> </span><span class=nv>path</span><span class=o>=</span>/var/lib/libvirt/images/VM-NAME-HERE,size<span class=o>=</span><span class=m>50</span><span class=w> </span>--cdrom<span class=w> </span>/path/to/iso/vm-os.iso<span class=w> </span>--network<span class=w> </span><span class=nv>bridge</span><span class=o>=</span>br0<span class=w> </span>--graphics<span class=w> </span>vnc<span class=w> </span>--autostart
</code></pre></div> </div> </div> </div> <p>This will now execute and install your VM, the above command in my case was used to install a <code>Windows 10</code> VM, which needs user input to install unless you made youe own auto install image. So to setup the VM myself, I use the aforementioned application <code>cockpit</code>.</p> <p>Now head over to Cockpit (<code>http://host-ip-address:9090</code>) login with your user, from the main page you will notice a tab for <code>Virtual Machines</code> and from there drop down the menu of your VM. You will see a <code>Consoles</code> tab. Select this and you should see the output of the VM's console, allowing you to view and setup the VM. Once this is done you can (for Windows) setup remote access via RDP, SSH or otherwise.</p> <div class="admonition success"> <p class=admonition-title>CONGRATULATIONS! Enjoy your new KVM hypervisor.</p> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with ❤️ by J Harrison </div> </div> <div class=md-social> <a href=https://github.com/sudo-kraken target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["toc.integrate", "navigation.top", "navigation.expand", "navigation.tracking", "search.suggest", "search.highlight", "search.share", "navigation.sections", "content.tabs.link"], "search": "../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.7389ff0e.min.js></script> <script src=../javascripts/extra.js></script> </body> </html>